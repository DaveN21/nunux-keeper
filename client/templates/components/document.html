<div id="document" ng-class="{open: doc.opened}">
  <div class="loading" ng-if="loading">
    Processing...
    <span class="glyphicon glyphicon-refresh"></span>
  </div>
  <header>
    <a class="close" ng-click="closeDocument()">
      <span class="glyphicon glyphicon-remove-circle"></span>
    </a>

    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
        <span class="glyphicon glyphicon-plus"></span>
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu pull-right" role="menu">
        <li ng-if="!editing">
        <a class="pointer" ng-click="startEditing()">
          <span class="glyphicon glyphicon-pencil"></span>
          Edit the document
        </a>
        </li>

        <li ng-if="!editing" class="divider"></li>

        <li>
        <a ng-if="doc.link" ng-click="reFetchFromSource()" class="pointer" title="Create a new document from the source">
          <span class="glyphicon glyphicon-cloud-download"></span>
          Refetch from source
        </a>
        </li>
      </ul>
    </div>

    <h1 contenteditable="{{ editing }}" ng-model="doc.title"></h1>
    <span class="doc-meta">
      <span class="glyphicon glyphicon-time"></span>
      <time>{{ doc.date | date }}</time>
      <span class="glyphicon glyphicon-globe" ng-if="doc.link"></span>
      <a href="{{doc.link}}" title="View source" ng-if="doc.link" target="_blank">{{ doc.link | domain }}</a>
      <span class="glyphicon glyphicon-link" ng-if="isPublic(doc)"></span>
      <a href="/doc/{{doc._id}}" title="View public document" target="_blank" ng-if="isPublic(doc)">public link</a>
    </span>
    <ul class="categories" ng-show="editing || doc.categories.length">
      <li app-category-tag="cat" ng-repeat="cat in doc.categories" class="category" ng-class="{'editing': editing}"></li>
      <li>
      <form class="add-category" ng-if="editing">
        <select class="form-control input-sm"
          ng-model="selected"
          ng-change="addCategory(selected.key)"
          ng-options="cat.label for cat in categories" >
        </select>
      </form>
      </li>
    </ul>
  </header>
  <article contenteditable="{{ editing }}" ng-model="doc.content" class="readable">
  </article>
  <div class="doc-image" ng-if="isImage(doc)">
    <img src="" data-ng-src="/api/document/{{doc._id}}/resource/{{doc.attachment}}">
  </div>
  <div class="actions" ng-if="editing" >
    <button type="button" class="btn btn-default" ng-click="cancelDocument()">cancel</button>
    <button type="button" class="btn btn-success" ng-click="saveDocument(doc)">save</button>
  </div>
</div>
